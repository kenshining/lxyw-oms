layui.use(["form","layer","table","element"],function(){var a=layui.jquery,i=layui.form,t=(layui.table,layui.layer),l=(layui.element,[]);a("#addProductBtn").on("click",function(){e()}),a("#deleteProductBtn").on("click",function(){n()}),i.on("select(discount_type)",function(t){var e=a(t.elem).attr("id").split("_")[2],n=a("#product_item_"+e+"_discount_value");n.removeClass("layui-disabled"),n.val(""),1==t.value?n.attr("placeholder","请输入折扣额度，如：9.5"):2==t.value?n.attr("placeholder","请输入抹零后总价"):(3==t.value?n.attr("placeholder","免费"):n.attr("placeholder","无优惠"),n.addClass("layui-disabled")),o()}),a("body").on("change",'input[name="product_list_input"]',function(){o()});var e=function(t){var e="product_item_"+(new Date).getTime();l.push({id:e});var n='<tr name="'+e+'"><td rowspan="2" align="center" valign="middle"><input type="checkbox" name="product_Check" lay-skin="primary" value="'+e+'"></td><td>日本透明奶茶</td><td>4200340</td><td nowrap="nowrap">瓶装500ml*24/箱</td><td>日本|24个月|34kg/箱|0.1M3/箱</td><td><input type="text" name="product_list_input" id="'+e+'_single_price" autocomplete="off" class="layui-input" placeholder="单品金额（元）"></td><td><input type="text" name="product_list_input" id="'+e+'_count" autocomplete="off" class="layui-input" placeholder="订购数量（箱）"></td><td><input type="text" name="product_list_input" id="'+e+'_present" autocomplete="off" class="layui-input" placeholder="搭赠量（件）"></td></tr><tr name="'+e+'" style="background-color:rgb(250, 255, 189);"><td><select name="discount_type" lay-verify="" id="'+e+'_discount_type" lay-filter="discount_type"><option value="0" selected="true">无优惠</option><option value="1">折扣优惠</option><option value="2">抹零优惠</option><option value="3">免单</option></select></td><td><input type="text" name="product_list_input" id="'+e+'_discount_value" autocomplete="off" class="layui-input layui-disabled" placeholder="无优惠"></td><td colspan="5">单品类总价（元）：<em class="highlight">454.22</em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;优惠后总价（元）：<em class="highlight">532.9</em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;优惠金额（元）：<em class="highlight">532.9</em></td></tr>';a("#productListTable tr:first").before(n),i.render()},n=function(){a("input[name='product_Check']:checkbox:checked").each(function(){a("tr[name='"+a(this).val()+"']").remove();for(var t=[],e=0;e<l.length;e++)l[e].id!=a(this).val()&&t.push(l[e]);l=t})},o=function(){a("#productListTable").find("tr").each(function(){var t="";null!=a(this).attr("name")&&(t=a(this).attr("name").split("_")[2]);for(var e=0;e<l.length;e++)l[e].id=="product_item_"+t&&(l[e].singlePrice=a("#product_item_"+t+"_single_price").val(),l[e].count=a("#product_item_"+t+"_count").val(),l[e].present=a("#product_item_"+t+"_present").val(),l[e].discountType=a("#product_item_"+t+"_discount_type").val(),l[e].discountValue=a("#product_item_"+t+"_discount_value").val())}),a("#productListTable").attr("data",JSON.stringify(l)),console.log(JSON.stringify(l))};a("#selectCoustomBtn").on("click",function(){t.open({content:"/sales/chooes_customer",type:2,anim:2,title:"选择客户",btn:["取消"],skin:"layui-layer-rim",area:["90%","80%"],success:function(t,e){},end:function(){i.render("select")}})}),i.on("select(purchasing_contact)",function(t){var e=a(t.elem).attr("data");e=a.parseJSON(e);for(var n=0;n<e.length;n++)if(e[n].cellphone==t.value.split("|")[1]&&e[n].name==t.value.split("|")[0])return a("#transport_address").val(e[n].address),void a("#invoice_address").val(e[n].address)})});