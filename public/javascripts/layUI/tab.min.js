layui.define(["element","common"],function(t){"use strict";var f=layui.jquery,s=layui.element(),m=(layui.common,0),h=layui.layer,e=function(){this.config={elem:void 0,closed:!0,autoRefresh:!1,contextMenu:!1,onSwitch:void 0,openWait:!0}},b={};e.prototype.v="0.1.6",e.prototype.set=function(t){return f.extend(!0,this.config,t),this},e.prototype.init=function(){var t,e=this.config;"string"!=typeof e.elem&&"object"!=typeof e.elem&&common.throwError("Tab error: elem参数未定义或设置出错，具体设置格式请参考文档API."),"string"==typeof e.elem&&(t=f(""+e.elem)),"object"==typeof e.elem&&(t=e.elem),0===t.length&&common.throwError("Tab error:找不到elem参数配置的容器，请检查.");var i=t.attr("lay-filter");return void 0!==i&&""!==i||common.throwError("Tab error:请为elem容器设置一个lay-filter过滤器"),e.elem=t,b.titleBox=t.children("ul.layui-tab-title"),b.contentBox=t.children("div.layui-tab-content"),b.tabFilter=i,this},e.prototype.exists=function(i){void 0===b.titleBox&&this.init();var n=-1;return b.titleBox.find("li").each(function(t,e){f(this).children("cite").text()===i&&(n=t)}),n},e.prototype.getTabId=function(i){void 0===b.titleBox&&this.init();var n=-1;return b.titleBox.find("li").each(function(t,e){f(this).children("cite").text()===i&&(n=f(this).attr("lay-id"))}),n},e.prototype.tabAdd=function(t){var e,i=this,n=i.config,a=i.exists(t.title);if(-1===a){if(n.openWait&&(e=h.load(2)),"undefined"!==n.maxSetting){var o=n.elem.children("ul.layui-tab-title").children("li").length;if("number"==typeof n.maxSetting&&o===n.maxSetting)return void h.msg("为了系统的流畅度，只能同时打开"+n.maxSetting+"个选项卡。");if("object"==typeof n.maxSetting){var l=n.maxSetting.max||8,r=n.maxSetting.tipMsg||"为了系统的流畅度，只能同时打开"+l+"个选项卡。";if(o===l)return void h.msg(r)}}m++;var c='<iframe src="'+t.href+'" data-id="'+m+'"></iframe>',d="";void 0!==t.icon&&(-1!==t.icon.indexOf("fa-")?d+='<i class="fa '+t.icon+'" aria-hidden="true"></i>':d+='<i class="layui-icon">'+t.icon+"</i>"),d+="<cite>"+t.title+"</cite>",n.closed&&(d+='<i class="layui-icon layui-unselect layui-tab-close" data-id="'+m+'">&#x1006;</i>');var u=(new Date).getTime();s.tabAdd(b.tabFilter,{title:d,content:c,id:u}),b.contentBox.find("iframe[data-id="+m+"]").each(function(){f(this).height(b.contentBox.height())}),n.closed&&b.titleBox.find("li").children("i.layui-tab-close[data-id="+m+"]").on("click",function(){n.closeBefore?n.closeBefore({title:t.title,url:t.href,id:m,tabId:u})&&(s.tabDelete(b.tabFilter,f(this).parent("li").attr("lay-id")).init(),n.contextMenu&&f(document).find("div.uiba-contextmenu").remove()):(s.tabDelete(b.tabFilter,f(this).parent("li").attr("lay-id")).init(),n.contextMenu&&f(document).find("div.uiba-contextmenu").remove())}),s.tabChange(b.tabFilter,i.getTabId(t.title)),b.contentBox.find("iframe[data-id="+m+"]").on("load",function(){n.openWait&&h.close(e)})}else s.tabChange(b.tabFilter,i.getTabId(t.title)),n.autoRefresh&&n.elem.find("div.layui-tab-content > div").eq(a).children("iframe")[0].contentWindow.location.reload();n.contextMenu&&(s.on("tab("+b.tabFilter+")",function(t){f(document).find("div.admin-contextmenu").remove()}),b.titleBox.find("li").on("contextmenu",function(t){f(t.target);t.preventDefault(),t.stopPropagation();var e="LI"===t.target.nodeName?t.target:t.target.parentElement;0<f(document).find("div.admin-contextmenu").length&&f(document).find("div.admin-contextmenu").remove();var i=document.createElement("div");i.className="admin-contextmenu",i.style.width="130px",i.style.backgroundColor="white";i.innerHTML='<ul><li data-target="refresh" title="刷新当前选项卡"><i class="fa fa-refresh" aria-hidden="true"></i> 刷新</li><li data-target="closeCurrent" title="关闭当前选项卡"><i class="fa fa-close" aria-hidden="true"></i> 关闭当前</li><li data-target="closeOther" title="关闭其他选项卡"><i class="fa fa-window-close-o" aria-hidden="true"></i> 关闭其他</li><li data-target="closeAll" title="关闭全部选项卡"><i class="fa fa-window-close-o" aria-hidden="true"></i> 全部关闭</li></ul>',i.style.top=t.pageY+"px",i.style.left=t.pageX+"px",document.getElementsByTagName("body")[0].appendChild(i);var n=f(e).find("i.layui-tab-close").data("id"),a=f(e).attr("lay-id"),o=f(document).find("div.admin-contextmenu");return 0<o.length&&(o.eq(0).children("ul").children("li").each(function(){var e=f(this);e.on("click",function(){switch(e.data("target")){case"refresh":var t=b.contentBox.find("iframe[data-id="+n+"]")[0].src;b.contentBox.find("iframe[data-id="+n+"]")[0].src=t;break;case"closeCurrent":0!==a&&s.tabDelete(b.tabFilter,a);break;case"closeOther":b.titleBox.children("li").each(function(){var t=f(this),e=t.find("i.layui-tab-close").data("id");e!=n&&void 0!==e&&s.tabDelete(b.tabFilter,t.attr("lay-id"))});break;case"closeAll":b.titleBox.children("li").each(function(){var t=f(this);0!==t.index()&&s.tabDelete(b.tabFilter,t.attr("lay-id"))})}o.remove()})}),f(document).on("click",function(){o.remove()})),!1})),n.onSwitch&&s.on("tab("+b.tabFilter+")",function(t){n.onSwitch({index:t.index,elem:t.elem,id:b.titleBox.children("li").eq(t.index).attr("lay-id")})})},e.prototype.getCurrentTabId=function(){var t=this.config;return f(t.elem).find("ul.layui-tab-title").children("li.layui-this").attr("lay-id")},e.prototype.deleteTab=function(t){return s.tabDelete(b.tabFilter,t),this};var i=new e;t("tab",function(t){return i.set(t)})});