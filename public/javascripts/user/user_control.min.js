layui.use(["table","layer","element","jquery"],function(){var s=layui.table,o=layui.layer,r=(layui.element,layui.jquery);s.render({elem:"#table_content",id:"user_table",where:{t:(new Date).getTime(),username:r("#username_search").val(),name:r("#name_search").val(),cellphoneNo:r("#cellphoneNo_search").val()},url:"/user/user_findUserByPage",cols:[[{field:"username",align:"center",title:"用户名"},{field:"name",align:"center",title:"姓名"},{field:"sex",align:"center",title:"性别",templet:function(e){return"F"==e.sex?"女":"男"}},{field:"cellphoneNo",align:"center",title:"手机号"},{field:"birthdayStr",align:"center",title:"生日"},{fixed:"right",align:"center",title:"操作",toolbar:"#table_control_bar"}]],page:!0,loading:!0,limits:[10,20,50,90]}),r("#search").on("click",function(){s.reload("user_table",{page:{curr:1},where:{t:(new Date).getTime(),username:r("#username_search").val(),name:r("#name_search").val(),cellphoneNo:r("#cellphoneNo_search").val()},loading:!0})}),r("#add").on("click",function(){o.open({content:"/user/user_edit",type:2,anim:2,title:"新增用户信息",btn:["新增","取消"],skin:"layui-layer-rim",area:["500px","80%"],success:function(e,n){},yes:function(a,e){var n=o.getChildFrame("form",a),t=c(n);if(""==t){var l=o.load(2);r.post("/user/saveUser",{name:n.contents().find("input[name='name']").val(),username:n.contents().find("input[name='username']").val(),sex:n.contents().find("select[name='sex']").val(),email:n.contents().find("input[name='email']").val(),idcardNo:n.contents().find("input[name='idcardNo']").val(),birthday:n.contents().find("input[name='birthday']").val(),cellphoneNo:n.contents().find("input[name='cellphoneNo']").val(),wechat:n.contents().find("input[name='wechat']").val(),postCode:n.contents().find("input[name='postCode']").val(),address:n.contents().find("textarea[name='address']").val()},function(e,n,t){o.close(l),o.close(a),o.msg("用户数据保存成功"),s.reload("user_table")},"json")}else o.msg(t)}})}),s.on("tool(user_table_filter)",function(e){var n=e.data,t=e.event;e.tr;if("del"===t)o.confirm("确认要删除用户吗？",{icon:4,title:"删除",btn:["删除","取消"]},function(a){o.close(a);var l=o.load(2);o.close(l),r.post("/user/deleteUser",{id:n.id,t:(new Date).getTime()},function(e,n,t){o.close(l),o.close(a),o.msg("用户数据已删除！"),s.reload("user_table")},"json"),s.reload("user_table")});else if("edit"===t)o.open({content:"/user/user_edit?id="+n.id,type:2,anim:2,title:"编辑客户信息",btn:["保存","取消"],skin:"layui-layer-rim",area:["500px","80%"],success:function(e,n){},yes:function(a,e){var n=o.getChildFrame("form",a),t=c(n);if(""==t){var l=r(e).find("iframe")[0].contentWindow.document.getElementById("user_id").value,i=o.load(2);r.post("/user/saveUser",{name:n.contents().find("input[name='name']").val(),id:l,username:n.contents().find("input[name='username']").val(),sex:n.contents().find("select[name='sex']").val(),email:n.contents().find("input[name='email']").val(),idcardNo:n.contents().find("input[name='idcardNo']").val(),birthday:n.contents().find("input[name='birthday']").val(),cellphoneNo:n.contents().find("input[name='cellphoneNo']").val(),wechat:n.contents().find("input[name='wechat']").val(),postCode:n.contents().find("input[name='postCode']").val(),address:n.contents().find("textarea[name='address']").val()},function(e,n,t){o.close(i),o.close(a),o.msg("用户数据保存成功"),s.reload("user_table")},"json")}else o.msg(t)}});else if("reset"===t)o.open({content:"/user/reset_password",type:2,anim:2,title:"重置用户密码",btn:["发送重置邮件","取消"],skin:"layui-layer-rim",area:["450px","220px"],success:function(e,n){form.render()},yes:function(e,n){}})});var c=function(e){var n=new CommonValidationUtils,t=new CommonValidationEmu,a=e.contents().find("input[name='name']").val(),l=e.contents().find("input[name='username']").val(),i=(e.contents().find("select[name='sex']").val(),e.contents().find("input[name='email']").val()),s=e.contents().find("input[name='idcardNo']").val(),o=e.contents().find("input[name='birthday']").val(),r=e.contents().find("input[name='cellphoneNo']").val(),c=e.contents().find("input[name='wechat']").val(),d=e.contents().find("input[name='postCode']").val(),u=e.contents().find("textarea[name='address']").val();return n.isNull(a)||n.isNull(l)||n.isNull(i)||n.isNull(s)||n.isNull(o)||n.isNull(r)||n.isNull(c)||n.isNull(d)||n.isNull(u)?t.errorMsg.all_not_null:n.checkMobileNo(r)?n.checkIdCard(s)?n.isEmail(i)?"":t.errorMsg.all_worng_email:t.errorMsg.all_worng_idcardNo:t.errorMsg.all_worng_cellphoneNo}});