layui.use(["form","layer","table","jquery","laydate"],function(){var f=layui.jquery,i=layui.form,e=layui.table,l=layui.laydate;layui.layer;l.render({elem:"#productDate"}),l.render({elem:"#deadDate"}),f("#selectSupplier_show").on("click",function(){a("#stock_form","#supplier_select"),e.render({elem:"#supplier_select_List",id:"supplier_select_List",cellMinWidth:200,where:{t:(new Date).getTime(),supplierName:f("#supplierNameSelect").val()},url:"/stock/supplier_findByPage",cols:[[{field:"supplierName",align:"center",title:"供货商名称"},{field:"supplierType",align:"center",title:"供货商类别",templet:function(e){return"0"==e.supplierType?"公司客户":"个人客户"}},{field:"supplierEmail",align:"center",title:"邮件"},{field:"supplierCellphone",align:"center",title:"联系电话"},{field:"supplierLocation",align:"center",title:"供货商所属地区"},{fixed:"right",align:"center",title:"操作",toolbar:"#table_control_bar"}]],page:!0,loading:!0,limits:[10,20,50,90]}),f(".layui-layer-btn0",parent.document).hide()}),f("#searchSelectSupplierBtn").on("click",function(){e.reload("supplier_select_List",{page:{curr:1},where:{t:(new Date).getTime(),supplierName:f("#supplierNameSelect").val()},loading:!0})}),e.on("tool(supplier_select_List)",function(e){e.data;var t=e.event;e.tr;"selectSupplierBtn"===t&&a("#supplier_select","#stock_form",function(){f("html,body").animate({scrollTop:f("body").height()},"fast"),f("#supplier_select_input").val(e.data.supplierName),f("#supplierId").val(e.data.id),f(".layui-layer-btn0",parent.document).show()})});var a=function(e,t,i){f(e).fadeOut(50,function(){f(t).fadeIn(50,function(){"function"==typeof i&&i()})})};f("#addFeeBtn").on("click",function(){t()});var n=[],t=function(){var e="fee_item_"+(new Date).getTime(),t='<div class="layui-inline" id="'+e+'" name="'+e+'"><label class="layui-form-label">费用种类：</label><div class="layui-input-inline" style="min-width: 100px;"><select name="fee_select" id="'+e+'_select" lay-verify="" lay-filter="fee_select"><option value="预付款">预付款</option><option value="尾款">尾款</option><option value="增值税">增值税</option><option value="报关费">报关费</option><option value="物流费（国外）">物流费（国外）</option><option value="物流费（国内）">物流费（国内）</option><option value="海运费">海运费</option><option value="其他费用">其他费用</option> </select></div><div class="layui-input-inline" style="width: 200px;"><input type="text" name="fee_date" id="'+e+'_date" autocomplete="off" class="layui-input" placeholder="请输入付款日期"></div><div class="layui-input-inline" style="width: 200px;"><input type="text" name="fee_input" id="'+e+'_input" autocomplete="off" class="layui-input" placeholder="请输入金额（元）"></div><div class="layui-form-label"><button class="layui-btn layui-btn-xs layui-btn-danger" type="button" name="deleteFeeBtn"> <i class="layui-icon">&#xe640;</i>删除</button></div></div>';f("#fee_container").append(t),i.render(),l.render({elem:"#"+e+"_date",done:function(e,t){o()}}),n.push({id:e})};f("body").on("click",'button[name="deleteFeeBtn"]',function(){for(var e=[],t=0;t<n.length;t++)n[t].id!=f(this).parent().parent().attr("id")&&e.push(n[t]);n=e,f(this).parent().parent().remove(),u(),o()}),f("body").on("change",'input[name="fee_input"],input[name="fee_date"],input[name="stock_num_input"],input[name="storage_fee"]',function(){u(),o()}),i.on("select(fee_select)",function(e){o()});var o=function(){f("input[name='fee_input']").each(function(){for(var e=f(this).attr("id").split("_")[2],t=0;t<n.length;t++)n[t].id=="fee_item_"+e&&(n[t].feeType=f(this).parent().parent().find("select").val(),n[t].payDate=f(this).parent().parent().find("#fee_item_"+e+"_date").val(),n[t].feeNum=f(this).val())}),f("#fee_container").attr("data",JSON.stringify(n))},u=function(){for(var e=new CommonValidationUtils,t=new CommonUtils,i=f("input[name='fee_input']"),l=0,a=0;a<i.length;a++){var n=f(i[a]).val();if(e.isNumber(n)||e.isDecimal(n))l=t.floatAdd(l,n);else{if(""!=n&&!e.isNull())return l="-元",void f("#total_fee").html(l);l=t.floatAdd(l,0)}}var o=f("#storage_fee").val();(e.isNumber(o)||e.isDecimal(n))&&(l=t.floatAdd(l,o)),f("#total_fee").html(t.formatMoney(l)+"元");var u=f("#box_num").val(),p=f("#plus_num").val(),r=f("#format_num").val(),s=f("#wastage").val();if(e.isNull(u)||e.isNull(p)||e.isNull(r)||e.isNull(s))f("#everage_fee").html("-元");else{var d=t.floatMul(u,r);d=t.floatSub(d,s);var c=t.floatAdd(d,p);f("#everage_fee").html(t.formatMoney(t.floatDiv(l,c))+"元")}};if(0<f("#feeList").length){for(var p=f.parseJSON(f("#feeList").val()),r=0;r<p.length;r++){var s="fee_item_"+(new Date).getTime(),d='<div class="layui-inline" id="'+s+'" name="'+s+'"><label class="layui-form-label">费用种类：</label><div class="layui-input-inline" style="min-width: 100px;"><select name="fee_select" id="'+s+'_select" lay-verify="" lay-filter="fee_select"><option value="'+p[r].feeType+'">'+p[r].feeType+'</option> </select></div><div class="layui-input-inline" style="width: 200px;"><input type="text" name="fee_date" id="'+s+'_date" value="'+p[r].payDateStr+'" autocomplete="off" class="layui-input" placeholder="请输入付款日期"></div><div class="layui-input-inline" style="width: 200px;"><input type="text" name="fee_input" id="'+s+'_input" value="'+p[r].feeNum+'" autocomplete="off" class="layui-input" placeholder="请输入金额（元）"></div><div class="layui-form-label"><button class="layui-btn layui-btn-xs layui-btn-danger" type="button" name="deleteFeeBtn"> <i class="layui-icon">&#xe640;</i>删除</button></div></div>';f("#fee_container").append(d);var c={id:s,feeType:p[r].feeType,payDate:p[r].payDateStr,feeNum:p[r].feeNum};n.push(c),i.render(),l.render({elem:"#"+s+"_date",done:function(e,t){o()}})}u(),f("#fee_container").attr("data",JSON.stringify(n))}});