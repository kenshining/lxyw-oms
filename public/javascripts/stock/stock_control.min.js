layui.use(["layer","jquery","form","table","laydate"],function(){var h=layui.jquery,l=(layui.form,layui.table),t=layui.laydate,c=layui.layer;h("#search").on("click",function(){var t,n,e=h("#stock_search_date").val();""!=e?(t=e.split("~")[0],n=e.split("~")[1]):n=t="",l.reload("stock_table",{page:{curr:1},where:{t:(new Date).getTime(),productName:h("#productName_search").val(),productStatus:h("#productStatus_search").val(),start_date:t,end_date:n},loading:!0})}),t.render({elem:'input[name="stock_search_date"]',range:"~",format:"yyyy-MM-dd"}),h("#add").on("click",function(){var t=c.open({content:"/stock/stock_edit",type:2,anim:4,title:"编辑库存",btn:["保存","取消"],success:function(t,n){},yes:function(o,t){var n=c.getChildFrame("#stock_form",o),e=u(n);if(""==e){var a=h.parseJSON(n.contents().find("#fee_container").attr("data")),i=c.load(2);h.post("/stock/stock_save",{productName:n.contents().find("input[name='productName']").val(),productBatch:n.contents().find("input[name='productBatch']").val(),productDate:n.contents().find("input[name='productDate']").val(),deadDate:n.contents().find("input[name='deadDate']").val(),qno:n.contents().find("input[name='qno']").val(),location:n.contents().find("input[name='location']").val(),box_num:n.contents().find("#box_num").val(),positon:n.contents().find("select[name='positon']").val(),plus_num:n.contents().find("#plus_num").val(),plusPosition:n.contents().find("select[name='plusPosition']").val(),format_num:n.contents().find("#format_num").val(),guaranteeTime:n.contents().find("#guaranteeTime").val(),singleNetWeight:n.contents().find("#singleNetWeight").val(),singleCapacity:n.contents().find("#singleCapacity").val(),state:n.contents().find("#state").val(),storage:n.contents().find("#storage").val(),wastage:n.contents().find("#wastage").val(),supplierId:n.contents().find("#supplierId").val(),storage_fee:n.contents().find("#storage_fee").val(),feelist:JSON.stringify(a)},function(t,n,e){c.close(i),c.close(o),c.msg("库存保存成功"),l.reload("stock_table")},"json")}else c.msg(e)}});c.full(t)}),l.render({elem:"#table_content",id:"stock_table",url:"/stock/stock_findByPage",where:{t:(new Date).getTime()},cols:[[{field:"stockProductName",align:"center",title:"品名"},{field:"stockProductQno",align:"center",title:"条形码"},{field:"stockProductBatch",align:"center",title:"批次"},{field:"stockProductLocation",align:"center",title:"产地"},{field:"stockProductNum",align:"center",title:"规格",templet:function(t){return"瓶"==t.stockProductPlusPosition?t.stockProductSingleCapacity+"ml * "+t.stockProductFormatNum+t.stockProductPlusPosition+"/"+t.stockProductPosition:t.stockProductSingleNetweight+"kg * "+t.stockProductFormatNum+"/"+t.stockProductPlusPosition+t.stockProductPosition}},{field:"stockProductNum",align:"center",title:"入库量",templet:function(t){var n="";return t.stockProductPlusNum&&""!=t.stockProductPlusNum&&0!=t.stockProductPlusNum&&(n="|"+t.stockProductPlusNum+t.stockProductPlusPosition),t.stockProductNum+t.stockProductPosition+n}},{field:"supplierSubjectName",align:"center",title:"供应商"},{field:"stockProductStatus",align:"center",title:"库存状态",templet:function(t){return"0"==t.stockProductStatus?"在途（可预售）":"1"==t.stockProductStatus?"在售":"2"==t.stockProductStatus?"已售罄":"3"==t.stockProductStatus?"退货（在途":"4"==t.stockProductStatus?"已退货":"未识别状态"}},{fixed:"right",align:"center",width:180,title:"操作",toolbar:"#table_control_bar"}]],page:!0,loading:!0,limits:[10,20,50,90]}),l.on("tool(stock_table_filter)",function(t){var s=t.data,n=t.event;t.tr;if("del"===n)c.confirm("确认要删除库存吗？",{icon:4,title:"删除",btn:["删除","取消"]},function(o){c.close(o);var a=c.load(2);c.close(a),h.post("/stock/stock_delete",{id:s.id,t:(new Date).getTime()},function(t,n,e){c.close(a),c.close(o),c.msg("库存已删除！"),l.reload("stock_table")},"json"),l.reload("stock_table")});else if("edit"===n){var e=c.open({content:"/stock/stock_edit?id="+s.id,type:2,anim:2,title:"编辑库存信息",btn:["保存","取消"],success:function(t,n){},yes:function(o,t){var n=c.getChildFrame("#stock_form",o),e=u(n);if(""==e){var a=h.parseJSON(n.contents().find("#fee_container").attr("data")),i=c.load(2);h.post("/stock/stock_save",{id:s.id,productName:n.contents().find("input[name='productName']").val(),productBatch:n.contents().find("input[name='productBatch']").val(),productDate:n.contents().find("input[name='productDate']").val(),deadDate:n.contents().find("input[name='deadDate']").val(),qno:n.contents().find("input[name='qno']").val(),location:n.contents().find("input[name='location']").val(),box_num:n.contents().find("#box_num").val(),positon:n.contents().find("select[name='positon']").val(),plus_num:n.contents().find("#plus_num").val(),plusPosition:n.contents().find("select[name='plusPosition']").val(),format_num:n.contents().find("#format_num").val(),guaranteeTime:n.contents().find("#guaranteeTime").val(),singleNetWeight:n.contents().find("#singleNetWeight").val(),singleCapacity:n.contents().find("#singleCapacity").val(),state:n.contents().find("#state").val(),storage:n.contents().find("#storage").val(),wastage:n.contents().find("#wastage").val(),supplierId:n.contents().find("#supplierId").val(),storage_fee:n.contents().find("#storage_fee").val(),feelist:JSON.stringify(a)},function(t,n,e){c.close(i),c.close(o),c.msg("库存保存成功"),l.reload("stock_table")},"json")}else c.msg(e)}});c.full(e)}else if("stockStatus"===n)e=c.open({content:"/stock/stock_status?id="+s.id,type:2,anim:2,title:"库存状态处理",btn:["确定","取消"],skin:"layui-layer-rim",area:["916px","360px"],success:function(t,n){},yes:function(t,n){c.getChildFrame("form",t),c.load(2)}})});var u=function(t){var n=new CommonValidationUtils,e=new CommonValidationEmu,o=t.contents().find("input[name='productName']").val(),a=t.contents().find("input[name='productBatch']").val(),i=t.contents().find("input[name='productDate']").val(),s=t.contents().find("input[name='deadDate']").val(),l=t.contents().find("input[name='qno']").val(),c=t.contents().find("input[name='location']").val(),u=t.contents().find("#box_num").val(),d=t.contents().find("select[name='positon']").val(),r=t.contents().find("#plus_num").val(),f=t.contents().find("select[name='plusPosition']").val(),m=t.contents().find("#format_num").val(),p=t.contents().find("#guaranteeTime").val(),v=t.contents().find("#singleNetWeight").val(),g=t.contents().find("#singleCapacity").val(),k=(t.contents().find("#state").val(),t.contents().find("#storage").val(),t.contents().find("#wastage").val()),_=t.contents().find("#supplierId").val(),P=t.contents().find("#storage_fee").val();if(n.isNull(o)||n.isNull(a)||n.isNull(l)||n.isNull(c)||n.isNull(u)||n.isNull(d)||n.isNull(r)||n.isNull(f)||n.isNull(m)||n.isNull(p)||n.isNull(v)||n.isNull(g)||n.isNull(k)||n.isNull(i)||n.isNull(s)||n.isNull(_)||n.isNull(P))return e.errorMsg.all_not_null;for(var N=h.parseJSON(t.contents().find("#fee_container").attr("data")),y=0;y<N.length;y++)if(n.isNull(N[y].feeNum))return"未设置["+N[y].feeType+"],若无需保存此项，请删除。";return""}});