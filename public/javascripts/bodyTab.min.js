var tabFilter,liIndex,curNav,delMenu,menu=[];layui.define(["element","jquery"],function(t){var i,o=layui.element(),r=layui.jquery,e=function(){this.tabConfig={closed:!0,openTabNum:10,tabFilter:"bodyTab"}};if(""==r(".navBar").html()){r(".navBar").html(navBar(navs)).height(r(window).height()-230),o.init(),r(window).resize(function(){r(".navBar").height(r(window).height()-230)})}e.prototype.set=function(t){return r.extend(!0,this.tabConfig,t),this},e.prototype.getLayId=function(t){return r(".layui-tab-title.top_tab li").each(function(){r(this).find("cite").text()==t&&(i=r(this).attr("lay-id"))}),i},e.prototype.hasTab=function(t){var i=-1;return r(".layui-tab-title.top_tab li").each(function(){r(this).find("cite").text()==t&&(i=1)}),i};var s=0;e.prototype.tabAdd=function(t){window.sessionStorage.getItem("menu")&&(menu=JSON.parse(window.sessionStorage.getItem("menu")));var i=this,e=(i.tabConfig.closed,i.tabConfig.openTabNum);if(tabFilter=i.tabConfig.tabFilter,null!=t.find("i.iconfont,i.layui-icon").attr("data-icon")){var n="";if(-1==i.hasTab(t.find("cite").text())&&0==t.siblings("dl.layui-nav-child").length){if(r(".layui-tab-title.top_tab li").length==e)return void layer.msg("只能同时打开"+e+"个选项卡哦。不然系统会卡的！");s++,null!=t.find("i.iconfont").attr("data-icon")?n+='<i class="iconfont '+t.find("i.iconfont").attr("data-icon")+'"></i>':n+='<i class="layui-icon">'+t.find("i.layui-icon").attr("data-icon")+"</i>",n+="<cite>"+t.find("cite").text()+"</cite>",n+='<i class="layui-icon layui-unselect layui-tab-close" data-id="'+s+'">&#x1006;</i>',o.tabAdd(tabFilter,{title:n,content:"<iframe src='"+t.attr("data-url")+"' data-id='"+s+"'></frame>",id:(new Date).getTime()});var a={icon:null!=t.find("i.iconfont").attr("data-icon")?t.find("i.iconfont").attr("data-icon"):t.find("i.layui-icon").attr("data-icon"),title:t.find("cite").text(),href:t.attr("data-url"),layId:(new Date).getTime()};menu.push(a),window.sessionStorage.setItem("menu",JSON.stringify(menu)),window.sessionStorage.setItem("curmenu",JSON.stringify(a)),o.tabChange(tabFilter,i.getLayId(t.find("cite").text()))}else{a={icon:null!=t.find("i.iconfont").attr("data-icon")?t.find("i.iconfont").attr("data-icon"):t.find("i.layui-icon").attr("data-icon"),title:t.find("cite").text(),href:t.attr("data-url"),layId:(new Date).getTime()};window.sessionStorage.setItem("curmenu",JSON.stringify(a)),o.tabChange(tabFilter,i.getLayId(t.find("cite").text()))}}},r("body").on("click",".top_tab li",function(){var t,i=JSON.parse(window.sessionStorage.getItem("menu"));t=i[r(this).index()-1],0==r(this).index()?window.sessionStorage.setItem("curmenu",""):(window.sessionStorage.setItem("curmenu",JSON.stringify(t)),"undefined"==window.sessionStorage.getItem("curmenu")&&(curNav!=JSON.stringify(delMenu)?window.sessionStorage.setItem("curmenu",curNav):window.sessionStorage.setItem("curmenu",JSON.stringify(i[liIndex-1])))),o.tabChange(tabFilter,r(this).attr("lay-id")).init()}),r("body").on("click",".top_tab li i.layui-tab-close",function(){liIndex=r(this).parent("li").index();var t=JSON.parse(window.sessionStorage.getItem("menu"));delMenu=t[liIndex-1];var i="undefined"==window.sessionStorage.getItem("curmenu")?"undefined":""==window.sessionStorage.getItem("curmenu")?"":JSON.parse(window.sessionStorage.getItem("curmenu"));JSON.stringify(i)!=JSON.stringify(t[liIndex-1])?curNav=JSON.stringify(i):r(this).parent("li").length>liIndex?(window.sessionStorage.setItem("curmenu",i),curNav=i):(window.sessionStorage.setItem("curmenu",JSON.stringify(t[liIndex-1])),curNav=JSON.stringify(t[liIndex-1])),t.splice(liIndex-1,1),window.sessionStorage.setItem("menu",JSON.stringify(t)),o.tabDelete("bodyTab",r(this).parent("li").attr("lay-id")).init()});var n=new e;t("bodyTab",function(t){return n.set(t)})});