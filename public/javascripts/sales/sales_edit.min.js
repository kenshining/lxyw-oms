layui.use(["form","layer","table","element"],function(){var i=layui.jquery,l=layui.form,n=(layui.table,layui.layer,layui.element,[]);i("#addProductBtn").on("click",function(){t()}),i("#deleteProductBtn").on("click",function(){e()}),l.on("select(discount_type)",function(t){var e=i(t.elem).attr("id").split("_")[2],a=i("#product_item_"+e+"_discount_value");a.removeClass("layui-disabled"),1==t.value?a.attr("placeholder","请输入折扣额度，如：9.5"):2==t.value?a.attr("placeholder","请输入抹零后总价"):(3==t.value?a.attr("placeholder","免费"):a.attr("placeholder","无优惠"),a.addClass("layui-disabled")),o()});var t=function(t){var e="product_item_"+(new Date).getTime();n.push({id:e});var a='<tr name="'+e+'"><td rowspan="2" align="center" valign="middle"><input type="checkbox" name="product_Check" lay-skin="primary" value="'+e+'"></td><td>日本透明奶茶</td><td>4200340</td><td nowrap="nowrap">瓶装500ml*24/箱</td><td>日本|24个月|34kg/箱|0.1M3/箱</td><td><input type="text" name="single_price" id="'+e+'_single_price" autocomplete="off" class="layui-input" placeholder="单品金额（元）"></td><td><input type="text" name="count" id="'+e+'_count" autocomplete="off" class="layui-input" placeholder="订购数量（箱）"></td><td><input type="text" name="present" id="'+e+'_present" autocomplete="off" class="layui-input" placeholder="搭赠量（件）"></td></tr><tr name="'+e+'" style="background-color:rgb(250, 255, 189);"><td><select name="discount_type" lay-verify="" id="'+e+'_discount_type" lay-filter="discount_type"><option value="0" selected="true">无优惠</option><option value="1">折扣优惠</option><option value="2">抹零优惠</option><option value="3">免单</option></select></td><td><input type="text" name="total" id="'+e+'_discount_value" autocomplete="off" class="layui-input layui-disabled" placeholder="无优惠"></td><td colspan="5">单品类总价（元）：<em class="highlight">454.22</em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;优惠后总价（元）：<em class="highlight">532.9</em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;优惠金额（元）：<em class="highlight">532.9</em></td></tr>';i("#productListTable tr:first").before(a),l.render()},e=function(){i("input[name='product_Check']:checkbox:checked").each(function(){i("tr[name='"+i(this).val()+"']").remove();for(var t=[],e=0;e<n.length;e++)n[e].id!=i(this).val()&&t.push(n[e]);n=t})},o=function(){i("#productListTable").find("tr").each(function(){var t="";null!=i(this).attr("name")&&(t=i(this).attr("name").split("_")[2]);for(var e=0;e<n.length;e++)n[e].id=="product_item_"+t&&(n[e].singlePrice=i("#product_item_"+t+"_single_price").val(),n[e].count=i("#product_item_"+t+"_count").val(),n[e].present=i("#product_item_"+t+"_present").val(),n[e].discountType=i("#product_item_"+t+"_discount_type").val(),n[e].discountValue=i("#product_item_"+t+"_discount_value").val())}),i("#productListTable").attr("data",JSON.stringify(n)),console.log(JSON.stringify(n))}});