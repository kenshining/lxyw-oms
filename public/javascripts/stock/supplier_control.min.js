layui.use(["form","layer","jquery","table"],function(){var o=layui.jquery,r=(layui.form,layui.table),p=layui.layer;o("#add").on("click",function(){var e=p.open({content:"/stock/supplier_edit",type:2,anim:4,title:"编辑供货商",btn:["保存","取消"],success:function(e,l){},yes:function(t,e){var l=p.getChildFrame("form",t),i=u(l);if(""==i){var n=o.parseJSON(l.contents().find("#contact_table_container").attr("data")),a=p.load(2);o.post("/stock/supplier_save",{supplierName:l.contents().find("#supplierName").val(),supplierType:l.contents().find("#supplierType").val(),supplierEmail:l.contents().find("#supplierEmail").val(),supplierLocation:l.contents().find("#supplierLocation").val(),supplierCellphone:l.contents().find("#supplierCellphone").val(),supplierAddress:l.contents().find("#supplierAddress").val(),supplierRemark:l.contents().find("#supplierRemark").val(),indevidualList:JSON.stringify(n)},function(e,l,i){p.close(a),0==e.code?(p.close(t),p.msg("供应商信息成功"),r.reload("supplier_table")):p.msg("保存失败："+e.message)},"json")}else p.msg(i)}});p.full(e)}),o("#search").on("click",function(){r.reload("supplier_table",{page:{curr:1},where:{t:(new Date).getTime(),supplierName:o("#supplierNameSearch").val()},loading:!0})}),r.render({elem:"#table_content",id:"supplier_table",where:{t:(new Date).getTime(),supplierName:o("#supplierNameSearch").val()},url:"/stock/supplier_findByPage",cols:[[{field:"supplierName",align:"center",title:"供货商名称"},{field:"supplierType",align:"center",title:"供货商类别",templet:function(e){return"0"==e.supplierType?"公司客户":"个人客户"}},{field:"supplierEmail",align:"center",title:"邮件"},{field:"supplierCellphone",align:"center",title:"联系电话"},{field:"supplierLocation",align:"center",title:"供货商所属地区"},{fixed:"right",align:"center",title:"操作",toolbar:"#table_control_bar"}]],page:!0,loading:!0,limits:[10,20,50,90]}),r.on("tool(supplier_table_filter)",function(e){var s=e.data,l=e.event;e.tr;if("edit"===l){var i=p.open({content:"/stock/supplier_edit?id="+s.id,type:2,anim:2,title:"编辑供应商信息",btn:["保存","取消"],success:function(e,l){},yes:function(t,e){var l=p.getChildFrame("form",t),i=u(l);if(""==i){var n=o.parseJSON(l.contents().find("#contact_table_container").attr("data")),a=p.load(2);o.post("/stock/supplier_save",{id:s.id,supplierName:l.contents().find("#supplierName").val(),supplierType:l.contents().find("#supplierType").val(),supplierEmail:l.contents().find("#supplierEmail").val(),supplierLocation:l.contents().find("#supplierLocation").val(),supplierCellphone:l.contents().find("#supplierCellphone").val(),supplierAddress:l.contents().find("#supplierAddress").val(),supplierRemark:l.contents().find("#supplierRemark").val(),indevidualList:JSON.stringify(n)},function(e,l,i){p.close(a),0==e.code?(p.close(t),p.msg("供应商信息成功"),r.reload("supplier_table")):p.msg("保存失败："+e.message)},"json")}else p.msg(i)}});p.full(i)}else"del"===l&&p.confirm("确认要删除供应商和相关联系人吗？",{icon:4,title:"删除",btn:["删除","取消"]},function(t){p.close(t);var n=p.load(2);o.post("/stock/supplier_delete",{id:s.id,t:(new Date).getTime()},function(e,l,i){p.close(n),0==e.code?(p.close(t),p.msg("供应商与联系人数据已删除！"),r.reload("supplier_table")):p.msg("删除失败："+e.message)},"json")})});var u=function(){var e=o.parseJSON(dataForm.contents().find("#contact_table_container").attr("data")),l=dataForm.contents().find("#supplierName").val(),i=(dataForm.contents().find("#supplierType").val(),dataForm.contents().find("#supplierEmail").val()),t=dataForm.contents().find("#supplierLocation").val(),n=dataForm.contents().find("#supplierCellphone").val(),a=dataForm.contents().find("#supplierAddress").val(),s=dataForm.contents().find("#supplierRemark").val(),r=new CommonValidationUtils,p=new CommonValidationEmu;return r.isNull(l)||r.isNull(i)||r.isNull(t)||r.isNull(n)||r.isNull(a)||r.isNull(s)?p.errorMsg.all_not_null:e.length<=0?"必须设置一位[供应商联系人]":""}});