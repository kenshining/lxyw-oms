layui.use(["form","layer","table","jquery","laydate"],function(){var d=layui.jquery,i=layui.form,e=layui.table,l=(layui.laydate,layui.layer);d("#selectSupplier").on("click",function(){n("#product_form","#supplier_select"),e.render({elem:"#supplier_select_List",id:"supplier_select_List",cellMinWidth:200,where:{t:(new Date).getTime()},cols:[[{type:"checkbox"},{field:"name",align:"center",title:"供货商名称"},{field:"type",align:"center",title:"供货商类别",templet:function(e){return"0"==e.sex?"公司客户":"个人客户"}},{field:"email",align:"center",title:"邮件"},{field:"phone",align:"center",title:"联系电话"},{field:"location",align:"center",title:"供货商所属地区"},{fixed:"right",align:"center",title:"操作",toolbar:"#table_control_bar"}]],page:!0,loading:!0,limits:[10,20,50,90]}),d(".layui-layer-btn0",parent.document).hide()}),d("#searchSelectSupplierBtn").on("click",function(){e.reload("supplier_select_List",{page:{curr:1},where:{t:(new Date).getTime(),supplierName:d("#supplierName").val()},loading:!0})}),e.on("tool(supplier_select_List)",function(e){e.data;var t=e.event;e.tr;"selectSupplierBtn"===t&&(l.msg(e.data.id),n("#supplier_select","#product_form",function(){d("html,body").animate({scrollTop:d("body").height()},"fast"),d("#supplier_select_input").val(e.data.id),d(".layui-layer-btn0",parent.document).show()}))});var n=function(e,t,i){d(e).fadeOut(50,function(){d(t).fadeIn(50,function(){"function"==typeof i&&i()})})};d("#addFeeBtn").on("click",function(){t()});var a=[],t=function(){var e="fee_item_"+(new Date).getTime(),t='<div class="layui-inline" id="'+e+'"><label class="layui-form-label">费用种类：</label><div class="layui-input-inline" style="min-width: 100px;"><select name="fee_select" id="'+e+'_select" lay-verify=""><option>预付款</option> <option>尾款</option><option>增值税</option><option>报关费</option><option>物流费（国外）</option><option>物流费（国内）</option><option>海运费</option><option>其他费用</option> </select></div> <div class="layui-input-inline" style="width: 200px;"><input type="text" name="fee_input" id="'+e+'_input" autocomplete="off" class="layui-input" placeholder="请输入金额（元）"></div><div class="layui-form-label"><button class="layui-btn layui-btn-xs layui-btn-danger" type="button" name="deleteFeeBtn"> <i class="layui-icon">&#xe640;</i>删除</button></div></div>';d("#fee_container").append(t),i.render(),a.push({id:e}),console.log(JSON.stringify(a))};d("body").on("click",'button[name="deleteFeeBtn"]',function(){for(var e=[],t=0;t<a.length;t++)a[t].id!=d(this).parent().parent().attr("id")&&e.push(a[t]);a=e,d(this).parent().parent().remove(),console.log(JSON.stringify(a)),o()}),d("body").on("change",'input[name="fee_input"],input[name="stock_num_input"]',function(){o()});var o=function(){for(var e=new CommonValidationUtils,t=new CommonUtils,i=d("input[name='fee_input']"),l=0,n=0;n<i.length;n++){var a=d(i[n]).val();if(e.isNumber(a)||e.isDecimal(a))l=t.floatAdd(l,a);else{if(""!=a&&!e.isNull())return l="-元",void d("#total_fee").html(l);l=t.floatAdd(l,0)}}d("#total_fee").html(t.formatMoney(l)+"元");var o=d("#box_num").val(),u=d("#plus_num").val(),r=d("#format_num").val(),p=d("#wastage").val();if(e.isNull(o)||e.isNull(u)||e.isNull(r)||e.isNull(p))d("#everage_fee").html("-元");else{var s=t.floatMul(o,r);s=t.floatSub(s,p);var c=t.floatAdd(s,u);d("#everage_fee").html(t.formatMoney(t.floatDiv(l,c))+"元")}}});