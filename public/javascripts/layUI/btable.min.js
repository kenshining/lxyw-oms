layui.define(["element","common","paging","form"],function(e){"use strict";var a=layui.jquery,l=(void 0===parent.layer?layui.layer:parent.layer,layui.layer,layui.element(),layui.common,layui.paging()),c=layui.form(),t=function(){this.config={elem:void 0,params:{},columns:[],openWait:!1,url:void 0,type:"GET",even:!1,skin:void 0,field:"ID",paged:!1,singleSelect:!1,checkbox:!0,onSuccess:void 0},this.v="1.0.1"};t.prototype.set=function(e){return a.extend(!0,this.config,e),this},t.prototype.render=function(){for(var n=this.config,e=n.columns,t="",i=0;i<e.length;i++)e[i].sortable?t+='<th data-name="'+e[i].field+'">'+e[i].fieldName+'<div class="btable-order"><div class="up" title="升序"><i class="fa fa-sort-asc" aria-hidden="true"></i></div ><div class="down" title="倒序"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div></th>':t+="<th>"+e[i].fieldName+"</th>";t=n.checkbox&&!n.singleSelect?'<th style="width:28px;"><input type="checkbox" lay-filter="allselector" lay-skin="primary" /></th><th style="width:28px;">序号</th>'+t:n.checkbox?'<th style="width:28px;">#</th><th style="width:28px;">序号</th>'+t:'<th style="width:28px;">序号</th>'+t;var d='<div class="btable">';return void 0===n.skin||"line"!==n.skin&&"row"!==n.skin&&"nob"!==n.skin||!n.even?void 0===n.skin||"line"!==n.skin&&"row"!==n.skin&&"nob"!==n.skin?n.even?d+='<table class="layui-table layui-form" lay-even>':d+='<table class="layui-table layui-form">':d+='<table class="layui-table layui-form" lay-skin="'+n.skin+'">':d+='<table class="layui-table layui-form" lay-even lay-skin="'+n.skin+'">',d+="<thead><tr>"+t+"</tr></thead>",d+='<tbody class="btable-content"></tbody>',d+="</table>",n.paged&&(d+='<div data-type="paged" class="btable-paged"></div>'),d+="</div>",a(n.elem).html(d),l.init({url:n.url,elem:".btable-content",type:n.type,openWait:n.openWait,tempType:1,params:n.params,fail:n.onFail,complate:n.onComplate,serverError:n.onServerError,tempElem:function(e){var t=e.columns,i="{{# if(d.list.length>0 && d.list!=undefined){ }}";i+="{{# layui.each(d.list, function(index, item){ }}";for(var n="",d=0;d<t.length;d++)n+='<td data-field="'+t[d].field+'">{{ item.'+t[d].field+" }}</td>";n=e.checkbox?'<td><input type="checkbox" data-item="id" data-id="{{ item.'+e.field+' }}" lay-skin="primary" /></td><td>{{ (index+1) }}</td>'+n:'<td style="display:none;"><input type="hidden" data-item="id" value="{{ item.'+e.field+' }}" data-id="{{ item.'+e.field+' }}" name="id" /></td><td>{{ (index+1) }}</td>'+n;i+="<tr>"+n+"</tr>",i+="{{# }); }}",i+="{{# }else{ }}";var l=e.checkbox&&!e.singleSelect?t.length+1:t.length;return i+='<tr col="'+l+'">暂无数据.</tr>',i+="{{# } }}"}({columns:n.columns,checkbox:n.checkbox,field:n.field}),paged:n.paged,pageConfig:{skip:!0,elem:a(n.elem).find("div[data-type=paged]"),pageSize:n.pageSize||15},renderBefore:function(e,t,d){var i=(new Date).getTime();a("body").append('<table id="'+i+'" style="display:none;">'+e+"</table>");for(var l=n.columns,c=0;c<l.length;c++)l[c].format&&a("#"+i).find("tr").each(function(){for(var e=a(this).find("input[data-item=id]").val(),t=a(this).children("td[data-field="+l[c].field+"]"),i=void 0,n=0;n<d.length;n++)if(d[n].Id==e||d[n].ID==e||d[n].id==e){i=d[n];break}t.html(l[c].format(e,i))});t(a("#"+i).find("tbody").html()),a("#"+i).remove()},success:function(){a(n.elem).find("thead > tr > th").each(function(){var e=a(this),t=e.data("name");e.find("div.up").off("click").on("click",function(){a(this).hide(),a(this).siblings("div.down").show(),e.siblings("th").each(function(){a(this).attr("data-name")&&(a(this).find("div.up").show(),a(this).find("div.down").show())}),l.get({sort:t,order:"asc"})}),e.find("div.down").off("click").on("click",function(){a(this).hide(),a(this).siblings("div.up").show(),e.siblings("th").each(function(){a(this).attr("data-name")&&(a(this).find("div.up").show(),a(this).find("div.down").show())}),l.get({sort:t,order:"desc"})})}),c.render("checkbox"),c.on("checkbox(allselector)",function(e){var t=e.elem;a(n.elem).find("tbody.btable-content").children("tr").each(function(){a(this).children("td").eq(0).children("input[type=checkbox]")[0].checked=t.checked,c.render("checkbox")})}),n.checkbox&&a(n.elem).find("tbody.btable-content").children("tr").each(function(e){var i=a(this);i.on("click",function(){if(n.singleSelect)i.siblings().each(function(){a(this).children("td").eq(0).children("input[type=checkbox]")[0].checked=!1}),i.children("td").eq(0).children("input[type=checkbox]")[0].checked=!0;else{var e=i.children("td").eq(0).children("input[type=checkbox]")[0].checked;i.children("td").eq(0).children("input[type=checkbox]")[0].checked=!e;var t=0;i.parent("tbody").children("tr").each(function(){a(this).children("td:first-child").children("input")[0].checked&&t++}),a(n.elem).find("thead").children("tr").children("th:first-child").children("input[type=checkbox]")[0].checked=i.parent("tbody").children("tr").length===t}c.render("checkbox")})}),n.onSuccess&&n.onSuccess(a(n.elem).find("tbody.btable-content"))}}),this},t.prototype.get=function(e){l.get(e)},t.prototype.getSelected=function(i){var e=this.config;return e.singleSelect?(a(e.elem).find("tbody.btable-content").children("tr").each(function(){var e=a(this),t=e.children("td:first-child").children("input");t[0].checked&&i({elem:e,id:t.data("id")})}),this):i({})},t.prototype.isSelected=function(){var e=this.config;if(!e.singleSelect)return callback({});var t=a(e.elem).find("tbody.btable-content"),i=!1;return t.children("tr").each(function(){a(this).children("td:first-child").children("input")[0].checked&&(i=!0)}),i},t.prototype.getSelections=function(e){var t=this.config,i=a(t.elem).find("tbody.btable-content"),n=[],d=[],l=0;return i.children("tr").each(function(){var e=a(this),t=e.children("td:first-child").children("input");t[0].checked&&(n[l]=e,d[l]=t.data("id"),l++)}),e({elem:n,ids:d,count:n.length})};var i=new t;e("btable",function(e){return i.set(e)})});