layui.use(["form","layer","table","element"],function(){var n=layui.jquery,a=layui.form,l=(layui.table,layui.layer,layui.element,[]);n("#addProductBtn").on("click",function(){t()}),n("#deleteProductBtn").on("click",function(){e()}),a.on("select(discount_type)",function(t){var e=n(t.elem).attr("id").split("_")[2],i=n("#product_item_"+e+"_discount_value");i.removeClass("layui-disabled"),i.val(""),1==t.value?i.attr("placeholder","请输入折扣额度，如：9.5"):2==t.value?i.attr("placeholder","请输入抹零后总价"):(3==t.value?i.attr("placeholder","免费"):i.attr("placeholder","无优惠"),i.addClass("layui-disabled")),o()}),n("body").on("change",'input[name="product_list_input"]',function(){o()});var t=function(t){var e="product_item_"+(new Date).getTime();l.push({id:e});var i='<tr name="'+e+'"><td rowspan="2" align="center" valign="middle"><input type="checkbox" name="product_Check" lay-skin="primary" value="'+e+'"></td><td>日本透明奶茶</td><td>4200340</td><td nowrap="nowrap">瓶装500ml*24/箱</td><td>日本|24个月|34kg/箱|0.1M3/箱</td><td><input type="text" name="product_list_input" id="'+e+'_single_price" autocomplete="off" class="layui-input" placeholder="单品金额（元）"></td><td><input type="text" name="product_list_input" id="'+e+'_count" autocomplete="off" class="layui-input" placeholder="订购数量（箱）"></td><td><input type="text" name="product_list_input" id="'+e+'_present" autocomplete="off" class="layui-input" placeholder="搭赠量（件）"></td></tr><tr name="'+e+'" style="background-color:rgb(250, 255, 189);"><td><select name="discount_type" lay-verify="" id="'+e+'_discount_type" lay-filter="discount_type"><option value="0" selected="true">无优惠</option><option value="1">折扣优惠</option><option value="2">抹零优惠</option><option value="3">免单</option></select></td><td><input type="text" name="product_list_input" id="'+e+'_discount_value" autocomplete="off" class="layui-input layui-disabled" placeholder="无优惠"></td><td colspan="5">单品类总价（元）：<em class="highlight">454.22</em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;优惠后总价（元）：<em class="highlight">532.9</em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;优惠金额（元）：<em class="highlight">532.9</em></td></tr>';n("#productListTable tr:first").before(i),a.render()},e=function(){n("input[name='product_Check']:checkbox:checked").each(function(){n("tr[name='"+n(this).val()+"']").remove();for(var t=[],e=0;e<l.length;e++)l[e].id!=n(this).val()&&t.push(l[e]);l=t})},o=function(){n("#productListTable").find("tr").each(function(){var t="";null!=n(this).attr("name")&&(t=n(this).attr("name").split("_")[2]);for(var e=0;e<l.length;e++)l[e].id=="product_item_"+t&&(l[e].singlePrice=n("#product_item_"+t+"_single_price").val(),l[e].count=n("#product_item_"+t+"_count").val(),l[e].present=n("#product_item_"+t+"_present").val(),l[e].discountType=n("#product_item_"+t+"_discount_type").val(),l[e].discountValue=n("#product_item_"+t+"_discount_value").val())}),n("#productListTable").attr("data",JSON.stringify(l)),console.log(JSON.stringify(l))}});