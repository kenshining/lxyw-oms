layui.use(["form","layer","jquery","table"],function(){var u=layui.jquery,p=(layui.form,layui.table),r=layui.layer;u("#add").on("click",function(){var e=r.open({content:"/stock/supplier_edit",type:2,anim:4,title:"编辑供货商",btn:["保存","取消"],success:function(e,l){},yes:function(n,e){var l=r.getChildFrame("form",n),i=o(l);if(""==i){var t=u.parseJSON(l.contents().find("#contact_table_container").attr("data")),s=r.load(2);u.post("/stock/supplier_save",{supplierName:l.contents().find("#supplierName").val(),supplierType:l.contents().find("#supplierType").val(),supplierEmail:l.contents().find("#supplierEmail").val(),supplierLocation:l.contents().find("#supplierLocation").val(),supplierCellphone:l.contents().find("#supplierCellphone").val(),supplierAddress:l.contents().find("#supplierAddress").val(),supplierRemark:l.contents().find("#supplierRemark").val(),individualLink:JSON.stringify(t)},function(e,l,i){r.close(s),0==e.code?(r.close(n),r.msg("供应商信息成功"),p.reload("supplier_table")):r.msg("保存失败："+e.message)},"json")}else r.msg(i)}});r.full(e)}),u("#search").on("click",function(){p.reload("supplier_table",{page:{curr:1},where:{t:(new Date).getTime(),supplierName:u("#supplierNameSearch").val()},loading:!0})}),p.render({elem:"#table_content",id:"supplier_table",where:{t:(new Date).getTime(),supplierName:u("#supplierNameSearch").val()},url:"/stock/supplier_findByPage",cols:[[{field:"supplierName",align:"center",title:"供货商名称"},{field:"supplierType",align:"center",title:"供货商类别",templet:function(e){return"0"==e.supplierType?"公司客户":"个人客户"}},{field:"supplierEmail",align:"center",title:"邮件"},{field:"supplierCellphone",align:"center",title:"联系电话"},{field:"supplierLocation",align:"center",title:"供货商所属地区"},{fixed:"right",align:"center",title:"操作",toolbar:"#table_control_bar"}]],page:!0,loading:!0,limits:[10,20,50,90]}),p.on("tool(supplier_table_filter)",function(e){var a=e.data,l=e.event;e.tr;if("edit"===l){var i=r.open({content:"/stock/supplier_edit?id="+a.id,type:2,anim:2,title:"编辑供应商信息",btn:["保存","取消"],success:function(e,l){},yes:function(n,e){var l=r.getChildFrame("form",n),i=o(l);if(""==i){var t=u.parseJSON(l.contents().find("#contact_table_container").attr("data")),s=r.load(2);u.post("/stock/supplier_save",{id:a.id,supplierName:l.contents().find("#supplierName").val(),supplierType:l.contents().find("#supplierType").val(),supplierEmail:l.contents().find("#supplierEmail").val(),supplierLocation:l.contents().find("#supplierLocation").val(),supplierCellphone:l.contents().find("#supplierCellphone").val(),supplierAddress:l.contents().find("#supplierAddress").val(),supplierRemark:l.contents().find("#supplierRemark").val(),individualLink:JSON.stringify(t)},function(e,l,i){r.close(s),0==e.code?(r.close(n),r.msg("供应商信息成功"),p.reload("supplier_table")):r.msg("保存失败："+e.message)},"json")}else r.msg(i)}});r.full(i)}else"del"===l&&r.confirm("确认要删除供应商和相关联系人吗？",{icon:4,title:"删除",btn:["删除","取消"]},function(n){r.close(n);var t=r.load(2);u.post("/stock/supplier_delete",{id:a.id,t:(new Date).getTime()},function(e,l,i){r.close(t),0==e.code?(r.close(n),r.msg("供应商与联系人数据已删除！"),p.reload("supplier_table")):r.msg("删除失败："+e.message)},"json")})});var o=function(e){var l=e.contents().find("#supplierName").val(),i=(e.contents().find("#supplierType").val(),e.contents().find("#supplierEmail").val()),n=e.contents().find("#supplierLocation").val(),t=e.contents().find("#supplierCellphone").val(),s=e.contents().find("#supplierAddress").val(),a=e.contents().find("#supplierRemark").val(),p=new CommonValidationUtils,r=new CommonValidationEmu;if(p.isNull(l)||p.isNull(i)||p.isNull(n)||p.isNull(t)||p.isNull(s)||p.isNull(a))return r.errorMsg.all_not_null;var o=e.contents().find("#contact_table_container").attr("data");return null==o||""==o?"必须设置一位[供应商联系人]":u.parseJSON(e.contents().find("#contact_table_container").attr("data")).length<=0?"必须设置一位[供应商联系人]":""}});