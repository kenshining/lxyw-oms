var menu=[],openTabNum=10,tabIdIndex=0,element=layui.element,tabFilter="tabs";$(document).ready(function(){$(".lockcms").on("click",function(){window.sessionStorage.setItem("lockcms",!0),lockPage()}),"true"==window.sessionStorage.getItem("lockcms")&&lockPage(),$("#unlock").on("click",function(){""==$(this).siblings(".admin-header-lock-input").val()?layer.msg("请输入解锁密码！"):"123456"==$(this).siblings(".admin-header-lock-input").val()?(window.sessionStorage.setItem("lockcms",!1),$(this).siblings(".admin-header-lock-input").val(""),layer.closeAll(),$(".admin-header-lock").hide()):layer.msg("密码错误，请重新输入！")}),$(document).on("keydown",function(){13==event.keyCode&&$("#unlock").click()});var e=$(".site-tree-mobile"),i=$(".site-mobile-shade");e.on("click",function(){$("body").addClass("site-mobile")}),i.on("click",function(){$("body").removeClass("site-mobile")}),$(".layui-nav .layui-nav-item a").on("click",function(){openTab(this),$(this).parent("li").siblings().removeClass("layui-nav-itemed")}),bindMenuEmit(),""==$(".navBar").html()&&($(".navBar").html(initMenu([{title:"后台首页",icon:"icon-computer",href:"page/main.html",spread:!1},{title:"文章列表",icon:"icon-text",href:"page/news/newsList.html",spread:!1},{title:"友情链接",icon:"icon-text",href:"page/links/linksList.html",spread:!1},{title:"404页面",icon:"&#xe61c;",href:"page/404.html",spread:!1},{title:"系统基本参数",icon:"&#xe631;",href:"page/systemParameter/systemParameter.html",spread:!1},{title:"二级菜单演示",icon:"&#xe61c;",href:"",spread:!1,children:[{title:"二级菜单1",icon:"&#xe631;",href:"page/systemParameter/systemParameter.html",spread:!1},{title:"二级菜单2",icon:"&#xe631;",href:"",spread:!1}]}])).height($(window).height()-230),$(window).resize(function(){$(".navBar").height($(window).height()-230)})),currentTabFlash()});var initMenu=function(e){for(var i='<ul class="layui-nav layui-nav-tree">',t=0;t<e.length;t++){if(e[t].spread?i+='<li class="layui-nav-item layui-nav-itemed" data-href="'+e[t].href+'">':i+='<li class="layui-nav-item" data-href="'+e[t].href+'">',null!=e[t].children&&0<e[t].children.length){i+='<a href="javascript:;">',null!=e[t].icon&&""!=e[t].icon&&(-1!=e[t].icon.indexOf("icon-")?i+='<i class="iconfont '+e[t].icon+'" data-icon="'+e[t].icon+'"></i>':i+='<i class="layui-icon" data-icon="'+e[t].icon+'">'+e[t].icon+"</i>"),i+="<cite>"+e[t].title+"</cite>",i+='<span class="layui-nav-more"></span>',i+="</a>",i+='<dl class="layui-nav-child">';for(var n=0;n<e[t].children.length;n++)i+='<dd><a href="javascript:;" data-url="'+e[t].children[n].href+'">',null!=e[t].children[n].icon&&""!=e[t].children[n].icon&&(-1!=e[t].children[n].icon.indexOf("icon-")?i+='<i class="iconfont '+e[t].children[n].icon+'" data-icon="'+e[t].children[n].icon+'"></i>':i+='<i class="layui-icon" data-icon="'+e[t].children[n].icon+'">'+e[t].children[n].icon+"</i>"),i+="<cite>"+e[t].children[n].title+"</cite></a></dd>";i+="</dl>"}else i+='<a href="javascript:;" data-url="'+e[t].href+'">',null!=e[t].icon&&""!=e[t].icon&&(-1!=e[t].icon.indexOf("icon-")?i+='<i class="iconfont '+e[t].icon+'" data-icon="'+e[t].icon+'"></i>':i+='<i class="layui-icon" data-icon="'+e[t].icon+'">'+e[t].icon+"</i>"),i+="<cite>"+e[t].title+"</cite></a>";i+="</li>"}return i+="</ul>",$("#nav_bar").html(i),i},hasTab=function(e){var i=-1;return $(".layui-tab-title.top_tab li").each(function(){$(this).find("cite").text()==e&&(i=1)}),i},getLayId=function(e){return $(".layui-tab-title.top_tab li").each(function(){$(this).find("cite").text()==e&&(layId=$(this).attr("lay-id"))}),layId},openTab=function(e){window.sessionStorage.getItem("menu")&&(menu=JSON.parse(window.sessionStorage.getItem("menu")));var i=$(e);if(null!=i.find("i.iconfont,i.layui-icon").attr("data-icon"))if(-1==hasTab(i.find("cite").text())&&0==i.siblings("dl.layui-nav-child").length){if($(".layui-tab-title.top_tab li").length==openTabNum)return void layer.msg("只能同时打开"+openTabNum+"个选项卡。");tabIdIndex++;var t="";null!=i.find("i.iconfont").attr("data-icon")?t+='<i class="iconfont '+i.find("i.iconfont").attr("data-icon")+'"></i>':t+='<i class="layui-icon">'+i.find("i.layui-icon").attr("data-icon")+"</i>",t+="<cite>"+i.find("cite").text()+"</cite>",t+='<i class="layui-icon layui-unselect layui-tab-close" data-id="'+tabIdIndex+'">&#x1006;</i>',element.tabAdd(tabFilter,{title:t,content:"<iframe src='"+i.attr("data-url")+"' data-id='"+tabIdIndex+"'></frame>",id:(new Date).getTime()});var n={icon:null!=i.find("i.iconfont").attr("data-icon")?i.find("i.iconfont").attr("data-icon"):i.find("i.layui-icon").attr("data-icon"),title:i.find("cite").text(),href:i.attr("data-url"),layId:(new Date).getTime()};menu.push(n),window.sessionStorage.setItem("menu",JSON.stringify(menu)),window.sessionStorage.setItem("curmenu",JSON.stringify(n)),element.tabChange(tabFilter,getLayId(i.find("cite").text()))}else{n={icon:null!=i.find("i.iconfont").attr("data-icon")?i.find("i.iconfont").attr("data-icon"):i.find("i.layui-icon").attr("data-icon"),title:i.find("cite").text(),href:i.attr("data-url"),layId:(new Date).getTime()};window.sessionStorage.setItem("curmenu",JSON.stringify(n)),element.tabChange(tabFilter,getLayId(i.find("cite").text()))}},bindMenuEmit=function(){$("body").on("click",".top_tab li",function(){var e,i=JSON.parse(window.sessionStorage.getItem("menu"));e=i[$(this).index()-1],0==$(this).index()?window.sessionStorage.setItem("curmenu",""):(window.sessionStorage.setItem("curmenu",JSON.stringify(e)),"undefined"==window.sessionStorage.getItem("curmenu")&&(curNav!=JSON.stringify(delMenu)?window.sessionStorage.setItem("curmenu",curNav):window.sessionStorage.setItem("curmenu",JSON.stringify(i[liIndex-1])))),element.tabChange(tabFilter,$(this).attr("lay-id")).init()}),$("body").on("click",".top_tab li i.layui-tab-close",function(){liIndex=$(this).parent("li").index();var e=JSON.parse(window.sessionStorage.getItem("menu"));delMenu=e[liIndex-1];var i="undefined"==window.sessionStorage.getItem("curmenu")?"undefined":""==window.sessionStorage.getItem("curmenu")?"":JSON.parse(window.sessionStorage.getItem("curmenu"));JSON.stringify(i)!=JSON.stringify(e[liIndex-1])?curNav=JSON.stringify(i):$(this).parent("li").length>liIndex?(window.sessionStorage.setItem("curmenu",i),curNav=i):(window.sessionStorage.setItem("curmenu",JSON.stringify(e[liIndex-1])),curNav=JSON.stringify(e[liIndex-1])),e.splice(liIndex-1,1),window.sessionStorage.setItem("menu",JSON.stringify(e)),element.tabDelete(tabFilter,$(this).parent("li").attr("lay-id")).init()})},lockPage=function(){layer.open({title:!1,type:1,content:$("#lock-box"),closeBtn:0,shade:.9})},currentTabFlash=function(){if(null!=window.sessionStorage.getItem("menu")){menu=JSON.parse(window.sessionStorage.getItem("menu")),curmenu=window.sessionStorage.getItem("curmenu");for(var e="",i=0;i<menu.length;i++)e="","icon"==menu[i].icon.split("-")[0]?e+='<i class="iconfont '+menu[i].icon+'"></i>':e+='<i class="layui-icon">'+menu[i].icon+"</i>",e+="<cite>"+menu[i].title+"</cite>",e+='<i class="layui-icon layui-unselect layui-tab-close" data-id="'+menu[i].layId+'">&#x1006;</i>',element.tabAdd(tabFilter,{title:e,content:"<iframe src='"+menu[i].href+"' data-id='"+menu[i].layId+"'></frame>",id:menu[i].layId}),"undefined"!=curmenu?""==curmenu||"null"==curmenu?element.tabChange(tabFilter,""):JSON.parse(curmenu).title==menu[i].title&&element.tabChange(tabFilter,menu[i].layId):element.tabChange(tabFilter,menu[menu.length-1].layId)}};